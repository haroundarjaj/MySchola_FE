import{bA as k,bD as L,bZ as R,r as l,j as e,G as t,aA as y,aQ as v,bI as S,an as E,bJ as A,B as C,T as f,bL as W,y as q,bH as z,c1 as N,bN as $,bO as P,bP as F,bK as G,D as H,c2 as B}from"./index-DCElUTP8.js";import{F as O,c as V,a as T,j as Q,I as J,d as K,b as U,k as Z,l as X,A as Y,e as ee,g as se}from"./AuthFooter-DEhTMBMX.js";import{s as te,a as re}from"./password-strength-8GWZyAaT.js";const ne=({...c})=>{const s=k("authentication").t,u=k("general").t,{showNotification:o}=L(),x=R(),[i,g]=l.useState(!1),[n,m]=l.useState(),b=()=>{g(!i)},h=r=>{r.preventDefault()},I=r=>{const a=te(r);m(re(a,s))},D=async(r,{setSubmitting:a})=>{a(!0);const p={password:r.password,token:c.token};Z(p).then(d=>{console.log(d),o(s("password_update_success"),"success"),x("login")}).catch(d=>{console.log(d),o(u(d.response.data.code),"error")}).finally(()=>{a(!1)})};return l.useEffect(()=>{I("")},[]),e.jsx(e.Fragment,{children:e.jsx(O,{initialValues:{password:"",passwordConfirm:""},validationSchema:V().shape({password:T().max(255).required(s("password_required")).test("password-strength",s("password_not_strong_enough"),r=>[s("normal"),s("good"),s("strong")].includes(n.label)),passwordConfirm:T().oneOf([Q("password"),null],s("passwords_not_matching")).required(s("password_confirm_required")).max(255)}),onSubmit:D,children:({errors:r,handleBlur:a,handleChange:p,handleSubmit:d,setFieldValue:oe,isSubmitting:M,touched:w,values:_})=>e.jsxs("form",{noValidate:!0,onSubmit:d,...c,children:[e.jsxs(t,{container:!0,spacing:2,sx:{mb:1},justifyContent:"flex-end",children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(y,{fullWidth:!0,error:!!(w.password&&r.password),children:[e.jsx(v,{htmlFor:"outlined-adornment-password-reset",children:s("password")}),e.jsx(S,{id:"outlined-adornment-password-reset",type:i?"text":"password",value:_.password,name:"password",label:s("password"),onBlur:a,onChange:j=>{p(j),I(j.target.value)},endAdornment:e.jsx(J,{position:"end",children:e.jsx(E,{"aria-label":"toggle password visibility",onClick:b,onMouseDown:h,edge:"end",size:"large",children:i?e.jsx(K,{}):e.jsx(U,{})})}),inputProps:{}}),w.password&&r.password&&e.jsx(A,{error:!0,id:"standard-weight-helper-text-password-reset",children:r.password})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(y,{fullWidth:!0,error:!!(w.passwordConfirm&&r.passwordConfirm),children:[e.jsx(v,{htmlFor:"outlined-adornment-confirm-password-register",children:s("confirm_password")}),e.jsx(S,{id:"outlined-adornment-confirm-password-register",type:i?"text":"password",value:_.passwordConfirm,name:"passwordConfirm",label:s("confirm_password"),onBlur:a,onChange:j=>{p(j)}}),w.passwordConfirm&&r.passwordConfirm&&e.jsx(A,{error:!0,id:"standard-weight-helper-text-confirm-password-register",children:r.passwordConfirm})]})}),e.jsx(t,{item:!0,xs:12,sm:3,alignItems:"center",children:e.jsx(y,{fullWidth:!0,children:e.jsx(C,{sx:{mb:2},children:e.jsxs(t,{container:!0,spacing:1,alignItems:"center",children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(C,{style:{backgroundColor:n==null?void 0:n.color},sx:{width:"100%",height:8,borderRadius:"7px"}})}),e.jsx(t,{item:!0,children:e.jsx(f,{variant:"subtitle1",fontSize:"0.75rem",children:n==null?void 0:n.label})})]})})})})]}),e.jsx(C,{sx:{mt:2},children:e.jsx(W,{children:e.jsx(q,{disableElevation:!0,disabled:M,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"secondary",children:u("confirm")})})})]})})})},le=()=>{const c=z(m=>m.breakpoints.down("md")),s=k("authentication").t,u=N(),[o,x]=l.useState(null),[i,g]=l.useState(!0),n=()=>o?B(o.expirationTime).isBefore(B()):!0;return l.useEffect(()=>{const b=new URLSearchParams(u.search).get("token");X(b).then(h=>{x(h.data)}).catch(h=>{x(null)}).finally(()=>{g(!1)})},[]),e.jsxs(Y,{children:[e.jsx(t,{container:!0,justifyContent:"center",alignItems:"center",sx:{minHeight:"calc(100vh - 68px)"},children:e.jsx(t,{item:!0,xs:12,sm:5,sx:{m:{xs:1,sm:3},mb:0},children:e.jsx(ee,{contentType:"login",children:!i&&(o&&!n()?e.jsxs(t,{container:!0,alignItems:"center",justifyContent:"center",children:[e.jsx(t,{container:!0,justifyContent:"center",alignItems:"center",sx:{mb:3},children:e.jsx(t,{item:!0,children:e.jsx($,{to:"#","aria-label":"logo",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("img",{src:P,alt:"MySchola",width:"100"}),e.jsx("img",{src:F,alt:"MySchola",width:"100"})]})})})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(t,{container:!0,direction:{xs:"column-reverse",md:"row"},alignItems:"center",justifyContent:"center",children:e.jsx(t,{item:!0,children:e.jsxs(G,{alignItems:"center",justifyContent:"center",spacing:1,children:[e.jsx(f,{color:"secondary.main",gutterBottom:!0,variant:c?"h3":"h2",children:s("reset_password_title")}),e.jsx(f,{variant:"caption",fontSize:"16px",textAlign:{xs:"center",md:"inherit"},children:s("reset_password_subtitle")})]})})})}),e.jsx(t,{item:!0,xs:12,sx:{mt:5},children:e.jsx(ne,{token:o.token})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(H,{})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsx("img",{src:P,alt:"MySchola",width:"100"}),e.jsx("img",{src:F,alt:"MySchola",width:"100"})]}),e.jsx(f,{variant:"subtitle1",textAlign:"center",sx:{mx:5,my:2},children:s("reset_link_expired")})]}))})})}),e.jsx(se,{})]})};export{le as default};
